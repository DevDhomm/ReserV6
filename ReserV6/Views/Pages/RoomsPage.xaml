<Page
  x:Class="ReserV6.Views.Pages.RoomsPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:ReserV6.Views.Pages"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="Salles"
  d:DataContext="{d:DesignInstance local:RoomsPage,
                                     IsDesignTimeCreatable=False}"
  d:DesignHeight="450"
  d:DesignWidth="800"
  ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  ScrollViewer.CanContentScroll="False"
  mc:Ignorable="d"
>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <StackPanel Grid.Row="0" Margin="16" Orientation="Vertical">
      <TextBlock FontSize="24" FontWeight="Bold" Text="Salles" />
      <TextBlock Margin="0,8,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="Trouvez et reservez la salle que vous recherchez" />
    </StackPanel>

    <!-- Filters Panel -->
    <Border Grid.Row="1" Background="{DynamicResource ControlAltFillColorSecondaryBrush}" Padding="16" Margin="16,0,16,16" CornerRadius="4">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!-- Search by Name -->
        <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,16,0">
          <TextBlock Text="Recherche par nom" FontSize="12" Margin="0,0,0,4" />
          <TextBox 
            x:Name="SearchTextBox"
            Text="{Binding ViewModel.SearchText, UpdateSourceTrigger=PropertyChanged}"
            Padding="8,6"
            Width="200"
            />
        </StackPanel>

        <!-- Filter by Capacity -->
        <StackPanel Grid.Column="1" Orientation="Vertical" Margin="0,0,16,0">
          <TextBlock Text="Capacite minimale" FontSize="12" Margin="0,0,0,4" />
          <TextBox 
            Text="{Binding ViewModel.MinCapacity, UpdateSourceTrigger=PropertyChanged}"
            Padding="8,6"
            Width="150"
            />
        </StackPanel>

        <!-- Filter by Floor -->
        <StackPanel Grid.Column="2" Orientation="Vertical" Margin="0,0,16,0">
          <TextBlock Text="Etage" FontSize="12" Margin="0,0,0,4" />
          <ComboBox 
            ItemsSource="{Binding ViewModel.Floors}"
            SelectedItem="{Binding ViewModel.SelectedFloor}"
            Padding="8,6"
            Width="150"
            />
        </StackPanel>

        <!-- Search by Equipment -->
        <StackPanel Grid.Column="3" Orientation="Vertical" Margin="0,0,16,0">
          <TextBlock Text="Filtrer par equipement" FontSize="12" Margin="0,0,0,4" />
          <Border 
            BorderBrush="{DynamicResource ControlElevationBorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Height="80"
            Width="250"
            Background="{DynamicResource ControlBackgroundBrush}"
            >
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="4">
              <ItemsControl 
                ItemsSource="{Binding ViewModel.AvailableEquipements}"
                >
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <CheckBox 
                      Content="{Binding Equipement.Nom}"
                      ToolTip="{Binding Equipement.Type}"
                      IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                      Margin="4,2"
                      />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Orientation="Vertical" />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
              </ItemsControl>
            </ScrollViewer>
          </Border>
          <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
            <TextBlock 
              Text="ðŸ“‹"
              FontSize="10"
              Margin="0,0,4,0"
              />
            <TextBlock 
              Text="{Binding ViewModel.SelectedEquipements.Count, StringFormat='SÃ©lectionnÃ©: {0}'}"
              FontSize="10"
              Foreground="{DynamicResource TextFillColorSecondaryBrush}"
              />
            <ui:Button 
              Content="RÃ©initialiser"
              Command="{Binding ViewModel.ClearEquipementsCommand}"
              Padding="4,0"
              Margin="8,0,0,0"
              FontSize="10"
              Height="20"
              />
          </StackPanel>
        </StackPanel>

        <!-- Apply Filters Button -->
        <StackPanel Grid.Column="4" VerticalAlignment="Bottom">
          <ui:Button 
            Content="Appliquer les filtres"
            Command="{Binding ViewModel.ApplyFiltersCommand}"
            Padding="12,8"
            />
        </StackPanel>

        <!-- Reset All Filters Button -->
        <StackPanel Grid.Column="5" VerticalAlignment="Bottom" Margin="8,0,0,0">
          <ui:Button 
            Content="ðŸ”„ Reset"
            Command="{Binding ViewModel.ResetAllFiltersCommand}"
            Padding="12,8"
            />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Rooms Grid with Cards -->
    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
      <ItemsControl ItemsSource="{Binding ViewModel.FilteredRooms, Mode=OneWay}" Padding="16">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <!-- Room Card -->
            <Border 
              Width="280" 
              Margin="8" 
              Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Padding="16"
              Opacity="{Binding Disponibilite, Converter={StaticResource AvailabilityOpacityConverter}}"
              >
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="*" />
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Availability Badge -->
                <Border 
                  Grid.Row="0"
                  Background="#D32F2F"
                  CornerRadius="3"
                  Padding="6,2"
                  HorizontalAlignment="Right"
                  Visibility="{Binding Disponibilite, Converter={StaticResource BoolToInvisibilityConverter}}"
                  Margin="0,0,0,8"
                  >
                  <TextBlock 
                    Text="INDISPONIBLE"
                    FontSize="10"
                    FontWeight="Bold"
                    Foreground="White"
                    />
                </Border>

                <!-- Room Name -->
                <TextBlock 
                  Grid.Row="1"
                  Text="{Binding Nom}" 
                  FontSize="16" 
                  FontWeight="Bold"
                  TextWrapping="Wrap"
                  Margin="0,0,0,8"
                  />

                <!-- Room Info (Capacity, Floor, Type) -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,8">
                  <TextBlock 
                    Text="{Binding Capacite, StringFormat='Capacite: {0} pers.'}" 
                    FontSize="12"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Margin="0,0,8,0"
                    />
                  <TextBlock 
                    Text="|" 
                    Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                    Margin="0,0,8,0"
                    />
                  <TextBlock 
                    Text="{Binding Etage, StringFormat='Etage {0}'}" 
                    FontSize="12"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    />
                </StackPanel>

                <!-- Description -->
                <TextBlock 
                  Grid.Row="3"
                  Text="{Binding Description}" 
                  FontSize="12"
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                  TextWrapping="Wrap"
                  VerticalAlignment="Top"
                  Margin="0,0,0,12"
                  />

                <!-- Reserve Button -->
                <ui:Button 
                  Grid.Row="4"
                  Content="Reserver"
                  HorizontalAlignment="Stretch"
                  Command="{Binding DataContext.ViewModel.ReserveCommand, RelativeSource={RelativeSource AncestorType=local:RoomsPage}}"
                  CommandParameter="{Binding}"
                  IsEnabled="{Binding Disponibilite}"
                  />
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</Page>
