<Page
  x:Class="ReserV6.Views.Pages.SallesGestionPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:ReserV6.Views.Pages"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="SallesGestion"
  d:DataContext="{d:DesignInstance local:SallesGestionPage,
                                     IsDesignTimeCreatable=False}"
  d:DesignHeight="600"
  d:DesignWidth="900"
  ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  ScrollViewer.CanContentScroll="False"
  mc:Ignorable="d"
>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<!-- Header -->
		<StackPanel Grid.Row="0" Margin="16" Orientation="Vertical">
			<TextBlock FontSize="24" FontWeight="Bold" Text="Gestion des Salles" />
			<TextBlock Margin="0,8,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="CrÃ©ez, modifiez et supprimez les salles disponibles" />
		</StackPanel>

		<!-- Search and Add Button Bar -->
		<Border Grid.Row="1" Margin="16,0,16,16" Background="{DynamicResource ControlAltFillColorSecondaryBrush}" Padding="16" CornerRadius="4">
			<StackPanel Orientation="Vertical">
				<StackPanel Orientation="Horizontal" Height="40" VerticalAlignment="Center">
					<TextBlock Text="Rechercher:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,12,0" />
					<TextBox
			Name="SearchTextBox"
			Width="300"
			Height="36"
			Margin="0,0,12,0"
			Text="{Binding ViewModel.SearchText, UpdateSourceTrigger=PropertyChanged}"
			Padding="12,8"
			VerticalAlignment="Center"
			Foreground="{DynamicResource TextFillColorPrimaryBrush}"
		  />
					<ui:Button
			Name="SearchButton"
			Width="110"
			Height="36"
			Content="ðŸ” Chercher"
			Command="{Binding ViewModel.SearchSallesCommand}"
			Padding="12,8"
			VerticalAlignment="Center"
			Margin="0,0,12,0"
		  />
					<ui:Button
			Name="AddButton"
			Width="150"
			Height="36"
			Content="âœ¨ Ajouter Salle"
			Command="{Binding ViewModel.AddNewSalleCommand}"
			Padding="12,8"
			VerticalAlignment="Center"
			Appearance="Primary"
		  />
				</StackPanel>
				<TextBlock
		  Text="ðŸ’¡ Tip: Vous pouvez chercher par nom de salle, description, type ou Ã©quipements"
		  FontSize="11"
		  Foreground="{DynamicResource TextFillColorSecondaryBrush}"
		  Margin="0,4,0,0"
		/>
			</StackPanel>
		</Border>

		<!-- DataGrid -->
		<DataGrid
      Grid.Row="2"
      Margin="16"
      ItemsSource="{Binding ViewModel.Salles}"
      SelectedItem="{Binding ViewModel.SelectedSalle}"
      AutoGenerateColumns="False"
      CanUserAddRows="False"
      CanUserDeleteRows="False"
      Background="{DynamicResource ApplicationBackgroundBrush}"
      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    >
			<DataGrid.Columns>
				<!-- Nom -->
				<DataGridTextColumn
          Header="Nom"
          Binding="{Binding Nom}"
          Width="210"
          IsReadOnly="True"
        />

				<!-- Description -->
				<!--		<DataGridTextColumn
          Header="Description"
          Binding="{Binding Description}"
          Width="200"
          IsReadOnly="True"
        /> -->

				<!-- CapacitÃ© -->
				<DataGridTextColumn
          Header="CapacitÃ©"
          Binding="{Binding Capacite}"
          Width="80"
          IsReadOnly="True"
        />

				<!-- Type -->
				<DataGridTextColumn
          Header="Type"
          Binding="{Binding Type}"
          Width="150"
          IsReadOnly="True"
        />

				<!-- Ã‰tage -->
				<DataGridTextColumn
          Header="Ã‰tage"
          Binding="{Binding Etage}"
          Width="60"
          IsReadOnly="True"
        />

				<!-- DisponibilitÃ© -->
				<DataGridCheckBoxColumn
          Header="Disponible"
          Binding="{Binding Disponibilite}"
          Width="80"
          IsReadOnly="True"
        />

				<!-- Ã‰quipements -->
				<DataGridTemplateColumn
          Header="Ã‰quipements"
          Width="150"
        >
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock
                Text="{Binding Equipements.Count, StringFormat='{}Nbre: {0}'}"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                VerticalAlignment="Center"
              />
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>

				<!-- Actions -->
				<DataGridTemplateColumn
		  Header="Actions"
		  Width="200"
		>
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal" Margin="0,0,8,0">
								<ui:Button
				  Name="EditButton"
				  Width="80"
				  Height="32"
				  Content="âœï¸ Ã‰diter"
				  Click="OnEditSalleClick"
				  Tag="{Binding}"
				  Padding="8,4"
				  FontSize="11"
				/>
								<ui:Button
				  Name="DeleteButton"
				  Width="80"
				  Height="32"
				  Content="ðŸ—‘ï¸ Suppr."
				  
				  Click="OnDeleteSalleClick"
				  Tag="{Binding}"
				  Padding="8,4"
				  FontSize="11"
				  Appearance="Secondary"
				/>
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Modal Form Overlay -->
		<Grid
      Grid.Row="0"
      Grid.RowSpan="3"
      Background="#7F000000"
      Visibility="{Binding ViewModel.IsFormVisible, Converter={StaticResource BoolToVisibilityConverter}}"
      ZIndex="100"
    >
			<!-- Form Container -->
			<Border
        Width="500"
        MaxHeight="650"
        Padding="24"
        Background="{DynamicResource ApplicationBackgroundBrush}"
        BorderBrush="{DynamicResource ControlElevationBorderBrush}"
        BorderThickness="1"
        CornerRadius="8"
        VerticalAlignment="Center"
        HorizontalAlignment="Center"
      >
				<ScrollViewer VerticalScrollBarVisibility="Auto">
					<StackPanel Orientation="Vertical">
						<!-- Form Title -->
						<TextBlock
              FontSize="18"
              FontWeight="Bold"
              Text="{Binding ViewModel.FormTitle}"
              Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              Margin="0,0,0,8"
            />

						<!-- Nom Field -->
						<StackPanel Orientation="Vertical" Margin="0,0,0,12">
							<TextBlock
                Text="Nom de la salle *"
                FontWeight="SemiBold"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                Margin="0,0,0,4"
              />
							<TextBox
                Height="36"
                Text="{Binding ViewModel.SalleNom, UpdateSourceTrigger=PropertyChanged}"
                Padding="12,8"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              />
						</StackPanel>

						<!-- Description Field -->
						<StackPanel Orientation="Vertical" Margin="0,0,0,12">
							<TextBlock
                Text="Description"
                FontWeight="SemiBold"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                Margin="0,0,0,4"
              />
							<TextBox
                Height="60"
                Text="{Binding ViewModel.SalleDescription, UpdateSourceTrigger=PropertyChanged}"
                Padding="12,8"
                TextWrapping="Wrap"
                VerticalAlignment="Top"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              />
						</StackPanel>

						<!-- CapacitÃ© Field -->
						<StackPanel Orientation="Vertical" Margin="0,0,0,12">
							<TextBlock
                Text="CapacitÃ© (personnes) *"
                FontWeight="SemiBold"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                Margin="0,0,0,4"
              />
							<TextBox
                Height="36"
                Text="{Binding ViewModel.SalleCapacite, UpdateSourceTrigger=PropertyChanged}"
                Padding="12,8"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              />
						</StackPanel>

						<!-- Type Field -->
						<StackPanel Orientation="Vertical" Margin="0,0,0,12">
							<TextBlock
				Text="Type de salle"
				FontWeight="SemiBold"
				Foreground="{DynamicResource TextFillColorPrimaryBrush}"
				Margin="0,0,0,4"
			  />
							<ComboBox
				Height="36"
				SelectedItem="{Binding ViewModel.SalleType, UpdateSourceTrigger=PropertyChanged}"
				ItemsSource="{Binding ViewModel.RoomTypes}"
				Padding="12,8"
				VerticalAlignment="Center"
			  />
						</StackPanel>

						<!-- Ã‰tage Field -->
						<StackPanel Orientation="Vertical" Margin="0,0,0,12">
							<TextBlock
                Text="Ã‰tage"
                FontWeight="SemiBold"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                Margin="0,0,0,4"
              />
							<TextBox
                Height="36"
                Text="{Binding ViewModel.SalleEtage, UpdateSourceTrigger=PropertyChanged}"
                Padding="12,8"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              />
						</StackPanel>

						<!-- DisponibilitÃ© CheckBox -->
						<CheckBox
              Content="Salle disponible"
              IsChecked="{Binding ViewModel.SalleDispo}"
              FontWeight="SemiBold"
              Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              Height="28"
              VerticalAlignment="Center"
              Margin="0,0,0,12"
            />

						<!-- Ã‰quipements Section -->
						<StackPanel Orientation="Vertical" Margin="0,0,0,12">
							<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
								<TextBlock
				  Text="Ã‰quipements de la salle"
				  FontWeight="SemiBold"
				  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
				  VerticalAlignment="Center"
				  Margin="0,0,12,0"
				/>
								<ui:Button
				  Name="AddEquipementButton"
				  Width="100"
				  Height="28"
				  Content="âž• Ajouter"
				  Command="{Binding ViewModel.AddNewEquipementCommand}"
				  Padding="8,4"
				  VerticalAlignment="Center"
				/>
							</StackPanel>
							<DataGrid
                Height="150"
                ItemsSource="{Binding ViewModel.EquipementsDeSalleSelectionnee}"
                SelectedItem="{Binding ViewModel.SelectedEquipement}"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              >
								<DataGrid.Columns>
									<DataGridTextColumn
                    Header="Nom"
                    Binding="{Binding Nom}"
                    Width="*"
                    IsReadOnly="True"
                  />
									<DataGridTextColumn
                    Header="Type"
                    Binding="{Binding Type}"
                    Width="80"
                    IsReadOnly="True"
                  />
									<DataGridCheckBoxColumn
                    Header="Fonctionnel"
                    Binding="{Binding EstFonctionnel}"
                    Width="70"
                    IsReadOnly="True"
                  />
									<DataGridTemplateColumn
					Header="Actions"
					Width="120"
				  >
										<DataGridTemplateColumn.CellTemplate>
											<DataTemplate>
												<StackPanel Orientation="Horizontal" Margin="0,0,4,0">
													<ui:Button
							Name="EditEquipementButton"
							Width="50"
							Height="28"
							Content="âœï¸"
							Click="OnEditEquipementClick"
							Tag="{Binding}"
							Padding="4,2"
							FontSize="11"
						  />
													<ui:Button
							Name="DeleteEquipementButton"
							Width="50"
							Height="28"
							Content="ðŸ—‘ï¸"
							Click="OnDeleteEquipementClick"
							Tag="{Binding}"
							Padding="4,2"
							FontSize="11"
							Appearance="Secondary"
						  />
												</StackPanel>
											</DataTemplate>
										</DataGridTemplateColumn.CellTemplate>
									</DataGridTemplateColumn>
								</DataGrid.Columns>
							</DataGrid>
						</StackPanel>

						<!-- Buttons -->
						<StackPanel Orientation="Horizontal" Margin="0,16,0,0">
							<ui:Button
				Name="SaveButton"
				Width="180"
				Height="36"
				Content="ðŸ’¾ Enregistrer"
				Command="{Binding ViewModel.SaveSalleCommand}"
				Padding="12,8"
				Margin="0,0,12,0"
				Appearance="Primary"
			  />
							<ui:Button
				Name="CancelButton"
				Width="180"
				Height="36"
				Content="âŒ Annuler"
				Command="{Binding ViewModel.CancelFormCommand}"
				Padding="12,8"
			  />
						</StackPanel>
					</StackPanel>
				</ScrollViewer>
			</Border>
		</Grid>

		<!-- Modal Form Overlay for Equipement -->
		<Grid
      Grid.Row="0"
      Grid.RowSpan="3"
      Background="#7F000000"
      Visibility="{Binding ViewModel.IsEquipementFormVisible, Converter={StaticResource BoolToVisibilityConverter}}"
      ZIndex="101"
    >
			<!-- Equipement Form Container -->
			<Border
        Width="450"
        Padding="24"
        Background="{DynamicResource ApplicationBackgroundBrush}"
        BorderBrush="{DynamicResource ControlElevationBorderBrush}"
        BorderThickness="1"
        CornerRadius="8"
        VerticalAlignment="Center"
        HorizontalAlignment="Center"
      >
				<StackPanel Orientation="Vertical">
					<!-- Form Title -->
					<TextBlock
            FontSize="16"
            FontWeight="Bold"
            Text="Ã‰quipement"
            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
            Margin="0,0,0,12"
          />

					<!-- Nom Field -->
					<StackPanel Orientation="Vertical" Margin="0,0,0,12">
						<TextBlock
              Text="Nom de l'Ã©quipement *"
              FontWeight="SemiBold"
              Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              Margin="0,0,0,4"
            />
						<TextBox
              Height="36"
              Text="{Binding ViewModel.EquipementNom, UpdateSourceTrigger=PropertyChanged}"
              Padding="12,8"
              Foreground="{DynamicResource TextFillColorPrimaryBrush}"
            />
					</StackPanel>

					<!-- Description Field -->
					<StackPanel Orientation="Vertical" Margin="0,0,0,12">
						<TextBlock
              Text="Description"
              FontWeight="SemiBold"
              Foreground="{DynamicResource TextFillColorPrimaryBrush}"
              Margin="0,0,0,4"
            />
						<TextBox
              Height="60"
              Text="{Binding ViewModel.EquipementDescription, UpdateSourceTrigger=PropertyChanged}"
              Padding="12,8"
              TextWrapping="Wrap"
              VerticalAlignment="Top"
              Foreground="{DynamicResource TextFillColorPrimaryBrush}"
            />
					</StackPanel>

					<!-- Type Field -->
					<StackPanel Orientation="Vertical" Margin="0,0,0,12">
						<TextBlock
			  Text="Type d'Ã©quipement *"
			  FontWeight="SemiBold"
			  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
			  Margin="0,0,0,4"
			/>
						<ComboBox
			  Height="36"
			  SelectedItem="{Binding ViewModel.EquipementType, UpdateSourceTrigger=PropertyChanged}"
			  ItemsSource="{Binding ViewModel.EquipementTypes}"
			  Padding="12,8"
			  VerticalAlignment="Center"
			/>
					</StackPanel>

					<!-- Fonctionnement CheckBox -->
					<CheckBox
			Content="Ã‰quipement fonctionnel"
			IsChecked="{Binding ViewModel.EquipementEstFonctionnel}"
			FontWeight="SemiBold"
			Foreground="{DynamicResource TextFillColorPrimaryBrush}"
			Height="28"
			VerticalAlignment="Center"
			Margin="0,0,0,16"
		  />

					<!-- Buttons -->
					<StackPanel Orientation="Horizontal" >
						<ui:Button
			  Name="SaveEquipementButton"
			  Width="170"
			  Height="36"
			  Content="ðŸ’¾ Enregistrer"
			  Command="{Binding ViewModel.SaveEquipementCommand}"
			  Padding="12,8"
			  Margin="0,0,12,0"
			  Appearance="Primary"
			/>
						<ui:Button
			  x:Name="CancelEquipementButton"
			  Width="170"
			  Height="36"
			  Content="âŒ Annuler"
			  Command="{Binding ViewModel.CancelEquipementFormCommand}"
			  Padding="12,8"
			/>
					</StackPanel>
				</StackPanel>
			</Border>
		</Grid>
	</Grid>
</Page>
