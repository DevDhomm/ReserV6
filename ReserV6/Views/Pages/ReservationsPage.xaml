<Page
  x:Class="ReserV6.Views.Pages.ReservationsPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:ReserV6.Views.Pages"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="Reservations"
  d:DataContext="{d:DesignInstance local:ReservationsPage,
                                     IsDesignTimeCreatable=False}"
  d:DesignHeight="450"
  d:DesignWidth="800"
  ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  ScrollViewer.CanContentScroll="False"
  mc:Ignorable="d"
>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <StackPanel Grid.Row="0" Margin="16" Orientation="Vertical">
      <TextBlock FontSize="24" FontWeight="Bold" Text="Reservations" />
      <TextBlock Margin="0,8,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="Consultez et gerez vos reservations" />
    </StackPanel>

    <!-- Filter Bar -->
    <StackPanel Grid.Row="1" Margin="16,0,16,16" Orientation="Horizontal" Height="40" VerticalAlignment="Center">
      <TextBlock Text="Filtre par statut:" VerticalAlignment="Center" Margin="0,0,12,0" FontWeight="SemiBold" />
      <ComboBox
        Name="StatusFilterComboBox"
        Width="200"
        Height="36"
        ItemsSource="{Binding ViewModel.StatusFilterOptions}"
        SelectedValue="{Binding ViewModel.SelectedStatusFilter}"
        Padding="12,8"
        VerticalAlignment="Center"
        />
    </StackPanel>

    <!-- DataGrid -->
    <DataGrid
      Grid.Row="2"
      Margin="16"
      AutoGenerateColumns="False"
      ItemsSource="{Binding ViewModel.FilteredReservations, Mode=OneWay}"
      SelectedItem="{Binding ViewModel.SelectedReservation}"
    >
      <DataGrid.RowStyle>
        <Style TargetType="{x:Type DataGridRow}">
          <Style.Triggers>
            <DataTrigger Binding="{Binding ., Converter={StaticResource ReservationStatusDynamicConverter}}" Value="EnCours">
              <Setter Property="Background" Value="#C8FFC8" />
            </DataTrigger>
            <DataTrigger Binding="{Binding ., Converter={StaticResource ReservationStatusDynamicConverter}}" Value="Terminee">
              <Setter Property="Background" Value="#DCDCDC" />
            </DataTrigger>
            <DataTrigger Binding="{Binding ., Converter={StaticResource ReservationStatusDynamicConverter}}" Value="Annulee">
              <Setter Property="Background" Value="#FFC8C8" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </DataGrid.RowStyle>
      <DataGrid.Columns>
        <DataGridTextColumn Binding="{Binding SalleNom}" Header="Salle" Width="130" />
        <DataGridTextColumn Binding="{Binding UserNom}" Header="Utilisateur" Width="130" />
        <DataGridTextColumn Binding="{Binding Motif}" Header="Motif" Width="150" />
        <DataGridTextColumn Binding="{Binding CreneauDebut, StringFormat=dd/MM/yyyy HH:mm}" Header="Debut" Width="130" />
        <DataGridTextColumn Binding="{Binding CreneauFin, StringFormat=dd/MM/yyyy HH:mm}" Header="Fin" Width="130" />
        <DataGridTextColumn Binding="{Binding ., Converter={StaticResource ReservationStatusDynamicConverter}}" Header="Statut" Width="100" />
        <DataGridTemplateColumn Header="Actions" Width="180">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal" Margin="4">
                <ui:Button
                  Content="Annuler"
                  Click="OnCancelReservationClick"
                  Tag="{Binding}"
                  Padding="8,4"
                  FontSize="11"
                  IsEnabled="{Binding IsNotFinalStatus}"
                  ToolTip="Annuler la reservation"
                  Margin="0,0,4,0"
                  />
                <ui:Button
                  Content="Supprimer"
                  Click="OnDeleteReservationClick"
                  Tag="{Binding}"
                  Padding="8,4"
                  FontSize="11"
                  ToolTip="Supprimer la reservation"
                  />
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>
  </Grid>
</Page>
