<Page
  x:Class="ReserV6.Views.Pages.ReservationsPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:ReserV6.Views.Pages"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="Reservations"
  d:DataContext="{d:DesignInstance local:ReservationsPage,
                                     IsDesignTimeCreatable=False}"
  d:DesignHeight="450"
  d:DesignWidth="800"
  ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  ScrollViewer.CanContentScroll="False"
  mc:Ignorable="d"
>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <StackPanel Grid.Row="0" Margin="16" Orientation="Vertical">
      <TextBlock FontSize="24" FontWeight="Bold" Text="Reservations" />
      <TextBlock Margin="0,8,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="Consultez et gerez vos reservations" />
    </StackPanel>

    <!-- Filter Bar -->
    <Border Grid.Row="1" Background="{DynamicResource ControlAltFillColorSecondaryBrush}" Padding="16" Margin="16,0,16,16" CornerRadius="4">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="200" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="200" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="200" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Statut Filter -->
        <TextBlock
          Grid.Column="0"
          Text="Statut:"
          VerticalAlignment="Center"
          Margin="0,0,12,0"
          FontWeight="SemiBold"
          />
        <ComboBox
          Grid.Column="1"
          Height="36"
          ItemsSource="{Binding ViewModel.StatusFilterOptions}"
          SelectedValue="{Binding ViewModel.SelectedStatusFilter}"
          Padding="12,8"
          VerticalAlignment="Center"
          />

        <!-- Salle Filter -->
        <TextBlock
          Grid.Column="2"
          Text="Salle:"
          VerticalAlignment="Center"
          Margin="16,0,12,0"
          FontWeight="SemiBold"
          />
        <TextBox
          Grid.Column="3"
          Text="{Binding ViewModel.SalleNameFilter, UpdateSourceTrigger=PropertyChanged}"
          Padding="12,8"
          Height="36"
          VerticalAlignment="Center"
          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
          />

        <!-- Motif Filter -->
        <TextBlock
          Grid.Column="4"
          Text="Motif:"
          VerticalAlignment="Center"
          Margin="16,0,12,0"
          FontWeight="SemiBold"
          />
        <TextBox
          Grid.Column="5"
          Text="{Binding ViewModel.MotifFilter, UpdateSourceTrigger=PropertyChanged}"
          Padding="12,8"
          Height="36"
          VerticalAlignment="Center"
          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
          />
      </Grid>
    </Border>

    <!-- Reservations List View -->
    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
      <ItemsControl ItemsSource="{Binding ViewModel.FilteredReservations, Mode=OneWay}" Padding="16">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <StackPanel Orientation="Vertical" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <!-- Reservation Card -->
            <Border
              Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Padding="16"
              Margin="0,0,0,12"
              >
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Reservation Info -->
                <Grid Grid.Column="0">
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                  </Grid.RowDefinitions>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                  </Grid.ColumnDefinitions>

                  <!-- Salle et Statut -->
                  <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,12">
                    <TextBlock
                      FontSize="16"
                      FontWeight="Bold"
                      Text="{Binding SalleNom, Mode=OneWay}"
                      Margin="0,0,12,0"
                      />
                    <Border
                      Background="{Binding ., Converter={StaticResource ReservationStatusBadgeColorConverter}, Mode=OneWay}"
                      CornerRadius="3"
                      Padding="8,4"
                      HorizontalAlignment="Left"
                      >
                      <TextBlock
                        Text="{Binding ., Converter={StaticResource ReservationStatusDynamicConverter}, Mode=OneWay}"
                        FontSize="11"
                        FontWeight="Bold"
                        Foreground="White"
                        />
                    </Border>
                  </StackPanel>

                  <!-- Utilisateur et Motif -->
                  <TextBlock
                    Grid.Row="1"
                    Grid.Column="0"
                    Text="Utilisateur:"
                    FontWeight="SemiBold"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    FontSize="12"
                    Margin="0,0,8,4"
                    />
                  <TextBlock
                    Grid.Row="1"
                    Grid.Column="1"
                    Text="{Binding UserNom, Mode=OneWay}"
                    FontSize="12"
                    Margin="0,0,0,4"
                    />

                  <!-- Motif -->
                  <TextBlock
                    Grid.Row="2"
                    Grid.Column="0"
                    Text="Motif:"
                    FontWeight="SemiBold"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    FontSize="12"
                    Margin="0,0,8,4"
                    VerticalAlignment="Top"
                    />
                  <TextBlock
                    Grid.Row="2"
                    Grid.Column="1"
                    Text="{Binding Motif, Mode=OneWay}"
                    FontSize="12"
                    Margin="0,0,0,12"
                    TextWrapping="Wrap"
                    />

                  <!-- Dates et Heures -->
                  <Border
                    Grid.Row="3"
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    Background="{DynamicResource ControlAltFillColorSecondaryBrush}"
                    Padding="12"
                    CornerRadius="4"
                    >
                    <StackPanel Orientation="Vertical">
                      <!-- Date Row -->
                      <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock
                          Text="ðŸ“… Date: "
                          FontWeight="Bold"
                          FontSize="12"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                          VerticalAlignment="Center"
                          />
                        <TextBlock
                          Text="{Binding DateDebut, StringFormat=dd/MM/yyyy, Mode=OneWay}"
                          FontSize="12"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                          VerticalAlignment="Center"
                          Margin="0,0,4,0"
                          />
                        <TextBlock
                          Text="Ã "
                          FontSize="12"
                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                          VerticalAlignment="Center"
                          Margin="0,0,4,0"
                          />
                        <TextBlock
                          Text="{Binding DateFin, StringFormat=dd/MM/yyyy, Mode=OneWay}"
                          FontSize="12"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                          VerticalAlignment="Center"
                          />
                      </StackPanel>

                      <!-- Time Row -->
                      <StackPanel Orientation="Horizontal">
                        <TextBlock
                          Text="ðŸ• Horaire: "
                          FontWeight="Bold"
                          FontSize="12"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                          VerticalAlignment="Center"
                          />
                        <TextBlock
                          FontSize="12"
                          Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                          VerticalAlignment="Center"
                          >
                          <Run Text="{Binding HeureDebut, StringFormat=hh\\:mm, Mode=OneWay}" />
                          <Run Text=" - " />
                          <Run Text="{Binding HeureFin, StringFormat=hh\\:mm, Mode=OneWay}" />
                        </TextBlock>
                      </StackPanel>
                    </StackPanel>
                  </Border>
                </Grid>

                <!-- Actions -->
                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Top" Margin="16,0,0,0">
                  <ui:Button
                    Content="Annuler"
                    Click="OnCancelReservationClick"
                    Tag="{Binding}"
                    Padding="12,8"
                    FontSize="11"
                    IsEnabled="{Binding IsNotFinalStatus}"
                    ToolTip="Annuler la reservation"
                    Margin="0,0,0,4"
                    />
                  <ui:Button
                    Content="Supprimer"
                    Click="OnDeleteReservationClick"
                    Tag="{Binding}"
                    Padding="12,8"
                    FontSize="11"
                    ToolTip="Supprimer la reservation"
                    Appearance="Secondary"
                    />
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</Page>
